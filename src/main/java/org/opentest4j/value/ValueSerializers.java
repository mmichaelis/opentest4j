
package org.opentest4j.value;

import org.opentest4j.value.serializer.DefaultValueSerializer;
import org.opentest4j.value.serializer.ValueSerializer;

import java.io.Serializable;
import java.util.ServiceLoader;

/**
 * @author Mark Michaelis
 * @since 1.0
 */
public final class ValueSerializers {
	private static ServiceLoader<ValueSerializer> valueSerializers = ServiceLoader.load(ValueSerializer.class);
	private static ValueSerializer DEFAULT_VALUE_SERIALIZER = new DefaultValueSerializer();

	private ValueSerializers() {
		// Utility class; don't instantiate
	}

	public static Serializable serialize(Object object) {
		Serializable result = DEFAULT_VALUE_SERIALIZER.serialize(object);
		for (ValueSerializer valueSerializer : valueSerializers) {
			if (result != null) {
				break;
			}
			result = valueSerializer.serialize(object);
		}
		return result;
	}
}
